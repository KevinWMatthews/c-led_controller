if(NOT CMAKE_CROSSCOMPILING)
    # It's a trick to figure out how to support both local and cross-compilation
    # for end products. Don't support it for now.
    message(FATAL_ERROR "hw_attiny861 products must be cross compiled!")
endif()

set (target Libhw_PinA0_High)

# Specify output path for files generated by custom AVR targets.
# CMake is smart enough to place output form add_executable in the runtime output directory
# Custom targets do not have this luxury; we must manually specify the path.
set (target_path "${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${target}")

add_executable(${target}.elf
    PinA0_High.c
)
target_link_libraries(${target}.elf PRIVATE ATtiny861::ATtiny861)

#TODO Do we want the Config.h file here? Perhaps we need a config file per project.
#target_include_directories(${target}.elf
#    "${PROJECT_BINARY_DIR}/include"         # Include generated Config.h file
#)

set_target_properties(${target}.elf PROPERTIES
    COMPILE_FLAGS ${AVR_COMPILE_FLAGS}
    LINK_FLAGS "${AVR_LINK_FLAGS} -Wl,-Map,${target_path}.map"
)

# Create a list of files that we need to clean.
#TODO I don't know how to get add_executable to clean extra generated files.
# To extend this list, use:
#   list(APPEND avr_clean_files
#       <filename>
#   )
set(avr_clean_files ${target_path}.map)

set_directory_properties(
    PROPERTY ADDITIONAL_MAKE_CLEAN_FILES
        "${avr_clean_files}"
)

include("${PROJECT_SOURCE_DIR}/AvrTargets.cmake")
